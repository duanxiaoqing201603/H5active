<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的2019年学习报告，快来围观吧</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="js/fastClick.js"></script>
    <link rel="stylesheet" href="css/common.css"/>
    <link rel="stylesheet" href="css/swiper.min.css"/>
    <link rel="stylesheet" href="css/report.css">
    <script src="js/swiper.min.js"></script>

</head>
<body>
<div id="app">
    <section class="swiper-container">
        <div v-show="noData" class="swiper-wrapper">
            <div class="swiper-slide first">
                <section class="bg_bone">
                    <img src="image/e_1_bone.png"/>
                </section>
                <div class="firstHeader">
                    <p>Hi,爱学习的</p>
                    <h2>{{first.username}}</h2>
                    <img src="image/e_2019.png"/>
                </div>
                <div class="firstMid">
                    <p>2019</p>
                    <p><span>医得</span>与你温暖同行</p>
                </div>
                <div class="firstBottom">
                    <h3 class="textColor">上滑查看我的报告</h3>
                </div>
                <section style="bottom:0.25rem" class="arrow"></section>
            </div>
            <div class="swiper-slide second">
                <section class="bg_bone">
                    <img src="image/e_bg2.png"/>
                </section>
                <div class="secondHeader">
                    <img src="image/e_2019.png"/>
                    <img src="image/e_medicine.png"/>
                    <img src="image/e_medicine.png">
                </div>
                <div class="secondMid">
                    <p class="textColor">{{second.firstDay}}</p>
                    <p>是你来到医得family的第一天</p>
                    <p>与<span class="textColor">{{second.totalNum}}</span>名小伙伴并肩同行</p>
                </div>
                <div class="secondBottom">
                    <p>这一年里</p>
                    <p>医得陪伴了你<span class="textColor">{{days}}</span>个日日夜夜</p>
                    <p>在学习的道路上</p>
                    <p>你不再孤独</p>
                </div>
                <div class="bottomCode footer">
                    <div class="bottomText">
                        <p>欲救人学医则可，欲谋利而学医不可。</p>
                        <p class="textRight">——【清】徐廷祚</p>
                    </div>
                    <div>
                        <img src="image/e_code.png"/>
                    </div>
                </div>
                <section class="arrow"></section>
            </div>
            <div class="swiper-slide third">
                <section class="bg_bone">
                    <img src="image/e_left_bone.png"/>
                </section>
                <div class="thirdHeader">
                    <img src="image/e_2019.png"/>
                </div>
                <div v-if="studyLength" class="thirdMid">
                    <p>这一年里</p>
                    <p>你努力学习了<span class="textColor">{{third.minutes}}</span>分钟</p>
                </div>
                <div v-if="studyLength" class="thirdBottom">
                    <p>共学习了<span class="textColor">{{studyLength}}</span>门学科</p>
                    <ul class="subList">
                        <li v-for="(item,index) in third.study" :key="index"> 《{{item}}》</li>
                    </ul>
                </div>
                <div v-else class="thirdBottom">
                    <p>你共在线{{third.minutes}}分钟</p>
                    <p>一共看了{{studyLength}}本笔记</p>
                    <p>再忙也不要忘记学习哦~</p>
                </div>
                <div class="bottomCode footer">
                    <div class="bottomText lineMore">
                        <p>只要生命还可珍贵的，</p>
                        <p>医生这个职业就永远倍受崇拜！</p>
                        <p class="textRight">——爱默生</p>
                    </div>
                    <div>
                        <img src="image/e_code.png"/>
                    </div>
                </div>
                <section class="arrow"></section>
            </div>
            <div class="swiper-slide four">
                <section class="bg_bone">
                    <img src="image/e_big_eye.png"/>
                </section>
                <div class="fourHeader">
                    <img src="image/e_2019.png"/>
                </div>
                <div v-if="fourth.note" class="fourMid">
                    <p>这一年里,</p>
                    <p>你翻开多的是</p>
                    <p class="textColor">《{{fourth.note}}》</p>
                </div>
                <div class="fourBottom">
                    <p v-show="fourth.note">不知期末考试的你</p>
                    <p v-show="fourth.note">是否如愿考出好成绩</p>
                    <p v-show="!fourth.note">少年不知勤学苦</p>
                </div>
                <div class="bottomCode footer">
                    <div class="bottomText lineMore">
                        <p>医非博不能通，非通不能精，非精不能专。必精而专，始能由博而约。</p>
                        <p class="textRight">——【清】徐廷祚</p>
                    </div>
                    <div>
                        <img src="image/e_code.png"/>
                    </div>
                </div>
                <img class="ball1" src="image/e_smail_ball.png">
                <!--<img class="ball2" src="image/e_smail_ball.png">-->
                <section class="arrow"></section>
            </div>
            <div class="swiper-slide five">
                <section class="bg_bone">
                    <img src="image/e_black_sky.png"/>
                </section>
                <section>
                    <img class="bg_bone1" src="image/e_bottom_people.png"/>
                </section>
                <div class="fiveHeader">
                    <img src="image/e_2019.png"/>
                </div>
                <div class="fiveMid">
                    <div v-if="morning">
                        <p class="textColor">{{fifth.time}}</p>
                        <p>你还在医得里学习</p>
                        <p>这样挑灯夜读的夜晚</p>
                        <p>这一年里，有<span class="textColor">{{fifth.total}}</span>天</p>
                        <p>你坚信，在成人的世界里</p>
                        <p>没有容易二字</p>
                    </div>
                    <div v-else>
                        <p>挑灯夜读</p>
                        <p>或许不是最好的选择</p>
						<p>但身为医学生的你</p>
						<p>十年辛苦“马什么梅”</p>
						<p>请坚信</p>
						<p>成功路上并不拥挤</p>
						<p>拥挤路上难以成功</p>
                    </div>
                </div>
                <div class="bottomCode footer">
                    <div style="width:75%" class="bottomText lineMore">
                        <p>夫医者，非仁爱之士，不可托也；非聪明理达，不可任也；非廉洁纯良，不可信也。</p>
                        <p class="textRight">——【清】杨泉</p>
                    </div>
                    <div>
                        <img src="image/e_code.png"/>
                    </div>
                </div>
                <section class="arrow"></section>
            </div>
            <div class="swiper-slide six">
                <section class="bg_bone">
                    <img src="image/e_moon.png"/>
                </section>
                <div class="sixHeader">
                    <img src="image/e_2019.png"/>
                </div>
                <div class="sixMid">
                    <p v-if="total">这一年里，你总共做了{{sixth.total}}道试题</p>
                    <p v-else style="text-align: center">有{{sixth.userNum}}名小伙伴做过测试题</p>
                    <ul v-if="total">
                        <li v-for="item in sixth.test">
                            <p class="textColor">{{item.note}}</p>
                            <p>共做了<span class="textColor">{{item.noteTotal}}</span>题，正确率<span class="textColor">{{item.percent}}</span>
                            </p>
                        </li>
                    </ul>
                    <p v-else style="text-align: center">做题更方便理解、记忆知识点哦</p>
                </div>
                <div class="bottomCode footer">
                    <div style="width:75%" class="bottomText">
                        <p>德不近佛者不以为医，才不近仙者不以为医</p>
                        <p class="textRight">——裘法祖</p>
                    </div>
                    <div>
                        <img src="image/e_code.png"/>
                    </div>
                </div>
                <section class="arrow"></section>
            </div>
            <div class="swiper-slide seven">
                <div class="sevenHeader">
                    <img src="image/e_2019.png"/>
                </div>
                <div class="sevenMid">
                    <p>这一年你的<span class="textColor">关键词</span>为</p>
                    <h3>{{seventh.keyword}}</h3>
                </div>
                <div class="sevenBottom">
                    <img src="image/e_cerebrum.png"/>
                    <button v-if="browserClient" @click="report">生成我的学习报告</button>
                    <button v-else @click="share">分享</button>
                </div>
                <div class="bottomCode footer">
                    <div style="width: 75%" class="bottomText lineMore">
                        <p>选择医学可能是偶然，但你一旦选择了，就必须用一生的忠诚和热情去对待它。</p>
                        <p class="textRight">——钟南山院士</p>
                    </div>
                    <div>
                        <img src="image/e_code.png"/>
                    </div>
                </div>
            </div>
        </div>
        <!-- 如果需要分页器 -->
        <div class="swiper-pagination"></div>

        <!-- 如果需要导航按钮 -->
        <!-- <div class="swiper-button-prev"></div>
         <div class="swiper-button-next"></div>-->
        <div v-if="!noData" class="other">
            <div class="otherImg">
                <img src="image/e_what.png"/>
            </div>
            <div class="otherMid">
                <p class="textColor">咦，我的学习报告呢？</p>
                <p>您在医得里还没有学习报告</p>
                <p>请联系客服</p>
                <p>微信号：eDrMD</p>
            </div>

        </div>
        <!-- 如果需要滚动条 -->
        <div style="display: none" class="swiper-scrollbar"></div>
        <!--遮罩-->
        <div v-if="IOSload" class="loading">
            <img class="IOSimg" src="image/share.png"/>
        </div>
        <div v-if="Androidload" class="loading">
            <img class="Androidimg" src="image/share1.png"/>
        </div>
    </section>
</div>
</body>

<script>
    let app = new Vue({
        el: "#app",
        data: {
            IP: '',//'http://39.105.11.4:80',
            client: '',
            version: '',
            data: '',
            first: '',
            second: '',
            third: '',
            fourth: '',
            fifth: '',
            sixth: '',
            seventh: '',
            studyLength: 0,
            morning: false,
            total: true,
            userId: '',
            token: '',
            appVersion: '',
            clientType: '',
            browserClient: false,
            noData: true,
            shareInfo:'',
            IOSload:false,
            Androidload:false,
			tIp:'http://app.edrmd.com/eDrMd_App/active/report/report.html',//app正式环境，test是测试
			days:'',

        },
        created() {
            FastClick.attach(document.body);
            ~function (desW) {
                let winW = document.documentElement.clientWidth;
                document.documentElement.style.fontSize = winW / desW * 100 + "px";
            }(375);
            let request = this.getRequest();
            this.userId = request['userId'];
            this.token = request['token'];
            this.appVersion = request['appVersion'];
			this.shareInfo = JSON.stringify({
                'title': '我的2019年学习报告，快来围观吧',
                'descr': '属于学生自己的学习报告',
                'thumImage': 'http://app.edrmd.com/upload/report/reportShare.jpg',
                'webPageUrl':this.tIp+'?userId='+this.userId+'&appVersion='+this.appVersion
            });

            let u = navigator.userAgent;
            let isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //如果输出结果是true就判定是android终端或者uc浏览器
            //let isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //根据输出结果true或者false来判断ios终端
            this.clientType = isAndroid ? "Android" : "IOS";
            this.browserClient=location.href.indexOf('token') === -1;
    },
        mounted() {
            new Swiper('.swiper-container', {
                direction: 'vertical',
                loop: false,
            });
            axios.post(this.IP + '/eDrMd_App/stat/summary/2019',
                {
                    'userId':this.userId,//'164895dfc571115',
                    'token': '1b0b5a837a872bdc20cb206bac279e9b7',//this.token,
                    'client': this.clientType,
                    'version': this.appVersion
                }).then((res) => {
                    if(!res.data.data.summary){
                        this.noData=false;
                    }
                this.data = res.data.data.summary;
                this.first = this.data.first;
                this.second = this.data.second;
				this.days = this.second.days;
                this.third = this.data.third;
                this.noData = this.third.minutes !== 0;
                this.studyLength = this.third.study.length;
                this.fourth = this.data.fourth;
                this.fifth = this.data.fifth;
                this.sixth = this.data.sixth;
                this.total = this.sixth.total !== 0;
                this.seventh = this.data.seventh;
				this.morning = this.fifth.userType;
				if(this.days > 365){
					this.days = 365
				}
                // if(this.fifth.userType){
                //     let time = this.fifth.time.substr(-5, 5);
                //     if (time >= '04:00' && time <= '20:00') {
                //         this.morning = true;
                //     }
                // }

            })

        },
        methods: {
            getRequest() {
                let url = location.search;
                let theRequest = {};
                if (url.indexOf('?') !== -1) {
                    let strs = url.substr(1);
                    let str = strs.split('&');
                    for (let i = 0; i < str.length; i++) {
                        theRequest[str[i].split('=')[0]] = str[i].split('=')[1];
                    }
                }
                return theRequest
            },
            report() {
                if (this.clientType === 'IOS') {
                    //alert(navigator.userAgent.toLocaleLowerCase().indexOf("micromessenger"));
					if(navigator.userAgent.toLocaleLowerCase().indexOf("micromessenger")!==-1){
						this.IOSload=true;
					}else{
						//判断useragent，当前设备为ios设备
						window.location.href ="iOSEdrmdApp://?news_url="+ this.tIp+"?activeId=123"; // iOS端URL Schema
						window.setTimeout(function () {
						    window.location = "http://qr.hotlnk.cn/21691766"; // appstore下载地址
						}, 2000);
					}
                } else if (this.clientType === 'Android') {
                    if(navigator.userAgent.toLocaleLowerCase().indexOf("micromessenger")!==-1){
                        this.Androidload=true;
                    }else{
                        window.location.href = "edrmd://activity/attr?type=1&news_url=" + this.tIp+"?activeId=123";
                        /***打开app的协议，有安卓同事提供***/
                        window.setTimeout(function () {
                            window.location = "http://qr.hotlnk.cn/21691766"; /***打开app的协议，有安卓同事提供***/
                        }, 2000);
                    }
                }
            },
            share() {
                if(this.clientType==='Android'){
                    android.clickShareButton(this.shareInfo);
                }else if(this.clientType==='IOS'){
                    clickShareButton(this.shareInfo);
                }
            }
        }
    })
</script>
</html>
